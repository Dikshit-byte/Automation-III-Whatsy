const venom=require("venom-bot"),dotenv=require("dotenv"),{Configuration:Configuration,OpenAIApi:OpenAIApi}=require("openai"),download=require("image-downloader"),{spawn:spawn}=require("child_process"),fetch=require("isomorphic-unfetch"),{getDetails:getDetails}=require("spotify-url-info")(fetch),youtube=require("youtube-metadata-from-url"),search=require("youtube-search"),yt=require("yt-converter");dotenv.config();var currentPath=process.cwd();let log=console.log,error=console.error;const configuration=new Configuration({apiKey:process.env.OPENAI_API_KEY}),configuration1=new Configuration({apiKey:process.env.OPENAI_API_KEY1}),openai=new OpenAIApi(configuration1),openai1=new OpenAIApi(configuration1);var opts={maxResults:2,key:process.env.YOUTUBE_API_KEY};async function searchNotes(e){return(await openai.createCompletion({model:"text-davinci-003",prompt:e,temperature:.3,max_tokens:1024,top_p:1,frequency_penalty:0,presence_penalty:.6,stop:[" Human:"," AI:"]})).data.choices[0].text}async function searchImage(e){const o=await openai1.createImage({prompt:e,n:1,size:"1024x1024"});return image_url=o.data.data[0].url,log(image_url),image_url}const books={B_1:"./books/Biography/Ikigai _ the Japanese secret to a long and happy life",B_2:"./books/Biography/Napoleon_ A Biography",B_3:"./books/Biography/Rich Dad Poor Dad",B_4:"./books/Biography/VIVEKANAND BIOGRAPHY",B_5:"./books/Biography/Wings of fire",E_1:"./books/Erotic/Dark-Desire",E_2:"./books/Erotic/rachel-g-ultimate-pleasure",E_3:"./books/Erotic/The-Roommate-by-Rosie-Danan",E_4:"./books/Erotic/You-had-me-at-hola",F_1:"./books/Fantasy/alices-adventures-in-wonderland",F_2:"./books/Fantasy/The-Adventures-of-Sherlock-Holmes",F_3:"./books/Fantasy/The-Canterville-Ghost",F_4:"./books/Fantasy/The-Ghost-Pirates",F_5:"./books/Fantasy/Treasure-Island",H_1:"./books/History/A HISTORY OF INDIA",H_2:"./books/History/A-History-of-the-Maratha-People",H_3:"./books/History/a-history-of-the-world1",N_1:"./books/Novel/Half Girlfriend by Chetan Bhagat",N_2:"./books/Novel/Healing-Her-Heart",N_3:"./books/Novel/One Indian Girl by Chetan Bhagat",N_4:"./books/Novel/The-Almost-Perfect-Murder",S_1:"./books/Spiritual/Bhagavad-Gita-Hindi",S_2:"./books/Spiritual/Chanakya Neeti",T_1:"./books/Travel/Around-the-World-in-80-Days"};function start(e){e.onMessage((async o=>{log(o.body);const n=o.body.split(": "),t=n[0]+": ",r=n[1];switch(o.body){case"Hi":e.sendText(o.from,"*Hey* bruh!!").then((e=>{})).catch((e=>{error("Error when sending: ",e)}));break;case"Menu":case"menu":e.sendText(o.from," \n              *Welcome to rootbot...*\n\n              \nThere is some option which are quite handy and can help you in your day to day life...\n\n              *1*. *NanoGPT* --\x3e Useful for queries, translation, code & much more.\n\n              *2*. *DiffusionAI* --\x3e Useful for text to image conversion \n\n              *3*. *SpotDL* --\x3e Useful for downloading spotify song directly from your whatsapp prompt\n\n              *4*. *YoutubeDL* --\x3e Useful for downloading songs from youtube\n\n              *5*. *BooksQuest* --\x3e Library for fetching some useful books\n\n              *~[NOTE]~* -> To know more about features, limitation & how to use them -> send model name like *NanoGPT* (Please keep the case of letters as it is)\n\n              ").then((e=>{})).catch((e=>{error("Error when sending: ",e)}));break;case"NanoGPT":e.sendText(o.from,"\n          *NanoGPT <help>* -\n\n          To use *NanoGPT*, use (Q: or q: ) followed by your query\n\n          *Example* --\x3e Q: Explain me theory of relativity \n\n          *[FEATURES]*: You can even ask your query in any language, e.g. ->  q: geeta ka updesh batao \n\n          *[LIMITATION]*: Getting response could take time depend on the answer length. So keep patience.\n\n      ").then((e=>{})).catch((e=>{error("Error when sending: ",e)}));break;case"DiffusionAI":e.sendText(o.from,"\n        *DiffusionAI <help>* -\n\n        To use *DiffusionAI*, use (I: or i: ) followed by your query\n\n        *Example* --\x3e I: A digital illustration of a steampunk library with clockwork machines, 4k, detailed, trending in artstation, fantasy vivid colors\n        *[FEATURES]*: It will give you image in response \n\n        *[LIMITATION]*: Getting response could take time depend as on my master mobile data speed and give better output on deep details in your prompt\n    ").then((e=>{})).catch((e=>{error("Error when sending: ",e)}));break;case"SpotDL":e.sendText(o.from,"\n        *SpotDL <help>* -\n\n        To use *SpotDL*, use (S: or s: )followed by your link\n\n        *Example* --\x3e S: https://open.spotify.com/track/6Fe0bY8vDxBnN7rDgu3ACE?si=29f3f01270d7488a\n\n        *[FEATURES]*: Can download spotify song directly in whatsapp\n\n        *[LIMITATION]*: Take max. of 30 sec to revert back the response and doesn't work on playlist. [Playlist download option will available soon].\n    ").then((e=>{})).catch((e=>{error("Error when sending: ",e)}));break;case"YoutubeDL":e.sendText(o.from,"\n          *YoutubeDL <help>* -\n\n          To use *YoutubeDL*, use (Y1: or y1: )followed by your link or (Y2: or y2:) followed by song name/lyrics\n\n          *Example* --\x3e \nY1: https://youtu.be/G7KNmW9a75Y\nY2: flowers song trending \n          *[FEATURES]*: Can download youtube song audio directly in whatsapp\n\n          *[LIMITATION]*: Take max. of 15sec to revert back the response and work only on songs, not on playlist or videos. [This features will available soon].\n      ").then((e=>{})).catch((e=>{error("Error when sending: ",e)}));break;case"BooksQuest":await e.sendText(o.from,"\n              *BooksQuest <help>* - \n\n              To use *BooksQuest*, use (B: or b: )followed by the book code by looking at below photo\n\n          ").then((e=>{})).catch((e=>{error("Error when sending: ",e)})),await e.sendImage(o.from,"./books/shelf_index.png","Books Code").then((e=>{})).catch((e=>{error("Error when sending: ",e)})),await e.sendText(o.from,"\n          If you want Treasure island book then look at the front code and send it.\n          *Example* --\x3e B: F_5\n\n        ").then((e=>{})).catch((e=>{error("Error when sending: ",e)}))}switch(t){case"Q: ":case"q: ":let l=await searchNotes(r);log("Sending...âž¡ï¸\n"),e.sendText(o.from,l).then((e=>{log("Done ðŸ‘\n")})).catch((e=>{error("Error when sending: ",e)}));break;case"S: ":case"s: ":function a(){getDetails(r).then((e=>{let o=`${e.preview.artist} - ${e.preview.title}`;return log(o),o})).then((n=>{log("Sending...âž¡ï¸\n"),e.sendVoice(o.from,`./music/${n}.mp3`).then((e=>{log("Done ðŸ‘\n")})).catch((e=>{error("Error when sending: ",e)}))}))}getDetails(r).then((e=>`${e.preview.artist} - ${e.preview.title}`)).then((e=>{!function(e){const o=spawn("python",["./dl/spot_tracks.py",r,e]);setTimeout(a,3e4),o.stdout.on("data",(e=>{log(e.toString())}))}(e)}));break;case"Y1: ":case"y1: ":async function s(){log("Sending...âž¡ï¸\n"),await youtube.metadata(r).then((n=>{title=n.title;let t=title.slice(1,6);e.sendVoice(o.from,`./ytMusic/${t}.mp3`).then((e=>{log("Done ðŸ‘\n")})).catch((e=>{error("Error when sending: ",e)}))}),(e=>{log(e)}))}!async function(e){await youtube.metadata(e).then((e=>{title=e.title;let o=title.slice(1,6);!function(e,o){log("Started Downloading... -> ",o);try{yt.convertAudio({url:e,itag:140,directoryDownload:"./ytMusic/",title:o})}catch(e){error(e)}}(r,o),setTimeout(s,15e3)}),(function(e){log(e)}))}(r);break;case"Y2: ":case"y2: ":async function i(){await search(r,opts,(function(n,t){n&&log(n);let r=t[0].title.slice(0,5);log("Sending...âž¡ï¸\n"),e.sendVoice(o.from,`./ytMusic/${r}.mp3`).then((e=>{log("Done ðŸ‘\n")})).catch((e=>{error("Error when sending: ",e)}))}))}!async function(){await search(r,opts,(function(e,o){e&&log(e);let n=o[0].link,t=o[0].title.slice(0,5);log(t," -> ",n),function(e,o){log("Started Downloading... -> ",o);try{yt.convertAudio({url:e,itag:140,directoryDownload:"./ytMusic/",title:o})}catch(e){error(e)}}(n,t),setTimeout(i,15e3)}))}();break;case"I: ":case"i: ":!async function(n,t){options={url:n,dest:t+"\\img",extractFilename:!0},await download.image(options).then((({filename:n})=>{log(n),e.sendImage(o.from,n,r).then((e=>{log("Done ðŸ‘\n")})).catch((e=>{error("Error when sending: ",e)}))})).catch((e=>error(e)))}(await searchImage(r),currentPath);break;case"B: ":case"b: ":let c=books[r].split("/");log(c[3]),e.sendFile(o.from,`${books[r]}.pdf`,`${books[r]}`).then((e=>{log("Done ðŸ‘\n")})).catch((e=>{error("Error when sending: ",e)}))}}))}venom.create({session:"session-name",multidevice:!0}).then((e=>start(e))).catch((e=>{log(e)}));