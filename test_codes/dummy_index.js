const venom=require("venom-bot"),dotenv=require("dotenv"),{Configuration:Configuration,OpenAIApi:OpenAIApi}=require("openai"),download=require("image-downloader"),{spawn:spawn}=require("child_process"),fetch=require("isomorphic-unfetch"),{getDetails:getDetails}=require("spotify-url-info")(fetch),youtube=require("youtube-metadata-from-url"),search=require("youtube-search"),yt=require("yt-converter");dotenv.config();var currentPath=process.cwd();let log=console.log,error=console.error;const configuration=new Configuration({apiKey:process.env.OPENAI_API_KEY}),configuration1=new Configuration({apiKey:process.env.OPENAI_API_KEY1}),openai=new OpenAIApi(configuration1),openai1=new OpenAIApi(configuration1);var opts={maxResults:2,key:process.env.YOUTUBE_API_KEY};async function searchNotes(e){return(await openai.createCompletion({model:"text-davinci-003",prompt:e,temperature:.3,max_tokens:1024,top_p:1,frequency_penalty:0,presence_penalty:.6,stop:[" Human:"," AI:"]})).data.choices[0].text}async function searchImage(e){const o=await openai1.createImage({prompt:e,n:1,size:"1024x1024"});return image_url=o.data.data[0].url,log(image_url),image_url}const books={B_1:"./books/Biography/Ikigai _ the Japanese secret to a long and happy life",B_2:"./books/Biography/Napoleon_ A Biography",B_3:"./books/Biography/Rich Dad Poor Dad",B_4:"./books/Biography/VIVEKANAND BIOGRAPHY",B_5:"./books/Biography/Wings of fire",E_1:"./books/Erotic/Dark-Desire",E_2:"./books/Erotic/rachel-g-ultimate-pleasure",E_3:"./books/Erotic/The-Roommate-by-Rosie-Danan",E_4:"./books/Erotic/You-had-me-at-hola",F_1:"./books/Fantasy/alices-adventures-in-wonderland",F_2:"./books/Fantasy/The-Adventures-of-Sherlock-Holmes",F_3:"./books/Fantasy/The-Canterville-Ghost",F_4:"./books/Fantasy/The-Ghost-Pirates",F_5:"./books/Fantasy/Treasure-Island",H_1:"./books/History/A HISTORY OF INDIA",H_2:"./books/History/A-History-of-the-Maratha-People",H_3:"./books/History/a-history-of-the-world1",N_1:"./books/Novel/Half Girlfriend by Chetan Bhagat",N_2:"./books/Novel/Healing-Her-Heart",N_3:"./books/Novel/One Indian Girl by Chetan Bhagat",N_4:"./books/Novel/The-Almost-Perfect-Murder",S_1:"./books/Spiritual/Bhagavad-Gita-Hindi",S_2:"./books/Spiritual/Chanakya Neeti",T_1:"./books/Travel/Around-the-World-in-80-Days"};function start(e){e.onMessage((async o=>{log(o.body);const t=o.body.split(": "),n=t[0]+": ",r=t[1];switch("Hi"===o.body&&!1===o.isGroupMsg&&e.sendText(o.from,"Hey bruh!!").then((e=>{log("Done 👍\n")})).catch((e=>{error("Error when sending: ",e)})),n){case"Q: ":case"q: ":let c=await searchNotes(r);log("Sending...➡️\n"),e.sendText(o.from,c).then((e=>{log("Done 👍\n")})).catch((e=>{error("Error when sending: ",e)}));break;case"S: ":case"s: ":function a(){getDetails(r).then((e=>{let o=`${e.preview.artist} - ${e.preview.title}`;return log(o),o})).then((t=>{log("Sending...➡️\n"),e.sendVoice(o.from,`./music/${t}.mp3`).then((e=>{log("Done 👍\n")})).catch((e=>{error("Error when sending: ",e)}))}))}getDetails(r).then((e=>`${e.preview.artist} - ${e.preview.title}`)).then((e=>{!function(e){const o=spawn("python",["./dl/spot_tracks.py",r,e]);setTimeout(a,3e4),o.stdout.on("data",(e=>{log(e.toString())}))}(e)}));break;case"Y1: ":case"y1: ":async function i(){log("Sending...➡️\n"),await youtube.metadata(r).then((t=>{title=t.title;let n=title.slice(1,6);e.sendVoice(o.from,`./ytMusic/${n}.mp3`).then((e=>{log("Done 👍\n")})).catch((e=>{error("Error when sending: ",e)}))}),(e=>{log(e)}))}!async function(e){await youtube.metadata(e).then((e=>{title=e.title;let o=title.slice(1,6);!function(e,o){log("Started Downloading... -> ",o);try{yt.convertAudio({url:e,itag:140,directoryDownload:"./ytMusic/",title:o})}catch(e){error(e)}}(r,o),setTimeout(i,15e3)}),(function(e){log(e)}))}(r);break;case"Y2: ":case"y2: ":async function s(){await search(r,opts,(function(t,n){t&&log(t);let r=n[0].title.slice(0,5);log("Sending...➡️\n"),e.sendVoice(o.from,`./ytMusic/${r}.mp3`).then((e=>{log("Done 👍\n")})).catch((e=>{error("Error when sending: ",e)}))}))}!async function(){await search(r,opts,(function(e,o){e&&log(e);let t=o[0].link,n=o[0].title.slice(0,5);log(n," -> ",t),function(e,o){log("Started Downloading... -> ",o);try{yt.convertAudio({url:e,itag:140,directoryDownload:"./ytMusic/",title:o})}catch(e){error(e)}}(t,n),setTimeout(s,15e3)}))}();break;case"I: ":case"i: ":!async function(t,n){options={url:t,dest:n+"\\img",extractFilename:!0},await download.image(options).then((({filename:t})=>{log(t),e.sendImage(o.from,t,r).then((e=>{log("Done 👍\n")})).catch((e=>{error("Error when sending: ",e)}))})).catch((e=>error(e)))}(await searchImage(r),currentPath);break;case"B: ":case"b: ":let l=books[r].split("/");log(l[3]),e.sendFile(o.from,`${books[r]}.pdf`,`${books[r]}`).then((e=>{log("Done 👍\n")})).catch((e=>{error("Error when sending: ",e)}))}}))}venom.create({session:"session-name",multidevice:!0}).then((e=>start(e))).catch((e=>{log(e)}));